<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title></title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width">
  <link rel="stylesheet" href="css/normalize.min.css">
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/style.css">

  <script src="js/vendor/modernizr-2.6.1.min.js"></script>
</head>
<body>

  <!--[if lt IE 7]>
      <p class="chromeframe">You are using an outdated browser. <a href="http://browsehappy.com/">Upgrade your browser today</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to better experience this site.</p>
  <![endif]-->

  <div class="screen"><canvas id="canvas_cam" width="640" height="480"></canvas></div>
  <div class="screen"><video id="video_cam"></video></div>

  <script src="js/vendor/jquery-1.8.0.min.js"></script>
  <!-- <script src="js/vendor/trackingjs/tracking.js"></script>
  <script src="js/vendor/trackingjs/tracker/color.js"></script> -->

  <script src="js/main.js"></script>
  <script>

  function hasGetUserMedia() {
    // Note: Opera builds are unprefixed.
    return !!(navigator.getUserMedia || navigator.webkitGetUserMedia ||
              navigator.mozGetUserMedia || navigator.msGetUserMedia);
  }
  
  function normalizeGetUserMedia(){
    navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia ||
                              navigator.mozGetUserMedia || navigator.msGetUserMedia;
  }

  if(hasGetUserMedia()){
    normalizeGetUserMedia();

    var successCallback = function(media){
      console.log('------------success');
      //console.log(media);

      var video = document.querySelector('#video_cam');
      video.src = window.webkitURL.createObjectURL(media);
      video.play();

      window.filterCount = 0;
      var changeFilter = function(event){
        element = event.target;
        var filters = ['sepia', 'blur', 'huerotate', 'greyscale'];

        var randomize = function(max, base){
          return Math.floor(Math.random() * base % (max + 1)  );
        }

        element.className = filters[(window.filterCount++) % 3];
        console.log(element.className);
      }

      video.addEventListener('click', changeFilter,  false);

      /* copying the frames to canvas */
      setInterval(function(){
        var canvas = document.querySelector('#canvas_cam');
        var ctx = canvas.getContext('2d');
        ctx.clearRect();
        console.log(video);
        ctx.drawImage(video, 0 , 0);
      }, 100);

    };

    var errorCallback = function(error){
      console.log('------------error');
      console.log(error);
    };

    navigator.getUserMedia({video: true}, successCallback, errorCallback);

  } else {
    console.log('getUserMedia n√£o suportado');
  }

  </script>
</body>
</html>